<% if @message.form.present? %>
  <%= render Common::OptionsComponent.new(id: "message-options") do |options| %>
    <% options.with_menu_content do %>
      <%= link_to download_message_message_object_path(@message, @message.form), data: { turbo_frame: '_top', turbo: false }, class: 'whitespace-nowrap flex gap-3', role: 'menu-item', tabindex: -1 do %>
        <%= render Icons::ArrowDownTrayComponent.new(css_classes: "w-5 h-5") %>
        Stiahnuť správu
      <% end %>
      <% if Current.tenant.feature_enabled?(:pdf_transformation) && @message.form&.downloadable_as_pdf? %>
        <%= link_to download_pdf_message_message_object_path(@message, @message.form), data: { turbo_frame: '_top', turbo: false }, class: 'whitespace-nowrap flex gap-3', role: 'menu-item', tabindex: -1 do %>
          <%= render Icons::ArrowDownTrayComponent.new(css_classes: "w-5 h-5") %>
          Stiahnuť ako PDF
        <% end %>
      <% end %>
      <%= link_to export_message_path(@message), data: { turbo_frame: '_top', turbo: false }, class: 'whitespace-nowrap flex gap-3', role: 'menu-item', tabindex: -1 do %>
        <svg class="shrink-0 w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m9 13.5 3 3m0 0 3-3m-3 3v-6m1.06-4.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
        </svg>
        Exportovať správu
      <% end %>
      <% if @message.form&.downloadable_archived_object? %>
        <%= link_to download_archived_message_message_object_path(@message, @message.form), class: "flex gap-3", role: "menuitem", tabindex: "-1" do %>
          <%= render Icons::ArrowDownTrayComponent.new(css_classes: "h-5 w-5") %>
          Stiahnuť archivovanú správu
        <% end %>
      <% end %>
      <% if @message.replyable? %>
          <%= form_with(url: reply_message_path(@message), method: :post, local: true, class: 'flex justify-strech items-start self-stretch flex-grow-0 flex-shrink-0 gap-2 p-6 border-t-0 border-r-0 border-b-0 border-l-0 border-gray-200') do |form| %>
            <%= form.hidden_field :original_message_id, value: @message.id %>
            <%= render Icons::ArrowUturnLeftComponent.new(css_classes: "w-5 h-5") %>
            <%= form.submit "Odpovedať", data: { turbo_frame: "_top" } do %>
            <% end %>
          <% end %>
      <% end %>
      <% if @mode == :thread_view && @message.collapsible? %>
        <% if @message.collapsed %>
          <%= button_to message_path(@message), params: { collapsed: false }, method: :patch, class: 'whitespace-nowrap flex gap-3', role: 'menu-item', tabindex: -1 do %>
              <%= render Icons::ChevronDownComponent.new(css_classes: "w-5 h-5") %>
              Vždy zobrazovať
          <% end %>
        <% else %>
          <%= button_to message_path(@message), params: { collapsed: true }, method: :patch, class: 'whitespace-nowrap flex gap-3', role: 'menu-item', tabindex: -1 do %>
            <%= render Icons::ChevronUpComponent.new(css_classes: "w-5 h-5") %>
            Zbaliť a už nerozbaľovať
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
