<%
  message_draft_body_form_id = "#{dom_id(@message, :body)}_form"
%>
<%= content_tag(:div,
  {
    "data-controller": "messageDrafts",
    "data-messageDrafts-message-draft-body-form-id": message_draft_body_form_id,
    "data-messageDrafts-authenticity-token": form_authenticity_token,
    "class": "mb-3 pt-0 w-full"
  }
) do %>
  <%= form_for :message_draft, url: message_draft_path(@message.id), method: 'patch', id: message_draft_body_form_id, builder: MessageDraftTemplateBuilder do |form| %>
    <% MessageDraftTemplateParser.parse_template_placeholders(@message.template).each do |placeholder| %>
      <%= form.template_field(placeholder, data: @message.metadata.dig('data'), editable: @message.editable?, is_last: @is_last) %>
    <% end %>
  <% end %>
<% end %>
