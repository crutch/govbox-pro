<div class="flex flex-col justify-stretch items-stretch">
  <%= render MessageThreadHeaderComponent.new(@message.thread) %>
  <div class="flex flex-col justify-stretch items-stretch gap-2 p-4">
    <% if @notice %>
      <div class="bg-blue-100 border-t border-b border-blue-500 text-blue-700 px-4 py-3 w-full" role="alert">
        <p class="font-bold"><%= @notice %></p>
      </div>
    <% end %>
    <div class="flex flex-col justify-stretch items-stretch rounded-md bg-white border border-gray-200">
      <div class="flex flex-col justify-stretch items-stretch gap-4 px-6 pt-6 pb-4 border-t-0 border-r-0 border-b border-l-0 border-gray-200">
        <div class="flex justify-between items-start gap-4">
          <div class="flex flex-col justify-stretch items-start  gap-2">
            <div class="flex justify-stretch items-start   relative gap-2">
              <p class="  w-[100px] text-base text-left text-gray-900">Odosielateľ:</p>
              <p class="  text-base font-semibold text-left text-gray-900"><%= @message.sender_name || 'Neznámy' %> </p>
            </div>
            <div class="flex justify-stretch items-start   relative gap-2">
              <p class="  w-[100px] text-base text-left text-gray-900"> Adresát: </p>
              <p class="  text-base font-semibold text-left text-gray-900"><%= @message.recipient_name || 'Neznámy' %></p>
            </div>
            <div class="flex justify-stretch items-start   gap-2 pt-1">
              <% @message.tags.each do |tag| %>
                <div class="flex justify-center items-center   relative  gap-1 px-2 py-1 rounded-md bg-gray-50 border border-gray-300">
                  <p class="  text-sm text-left text-gray-600"><%= tag.name %></p>
                  <%= button_to messages_tag_path(MessagesTag.find_by(message_id: @message.id, tag_id: tag.id)), method: :delete, form: { data: { turbo_confirm: "Naozaj odstrániť štítok #{tag.name} zo správy?" } } do %>
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="  w-3.5 h-3.5 relative" preserveAspectRatio="xMidYMid meet">
                      <path d="M3.5 3.5L10.5 10.5M3.5 10.5L10.5 3.5L3.5 10.5Z" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  <% end %>
                </div>
              <% end %>
              <%= render Common::TagSelectorComponent.new(@message) %>
            </div>
          </div>
          <div class="flex flex-col justify-strech items-start flex-grow gap-1">
            <div class="flex justify-strech items-start flex-grow-0 flex-shrink-0 relative gap-2">
              <% if @message.authorized? %>
                <div class="flex justify-center items-center flex-grow-0 flex-shrink-0 relative overflow-hidden gap-1.5 px-2 py-1 rounded-md bg-blue-50 border border-blue-300">
                  <p class="flex-grow-0 flex-shrink-0 text-sm text-left text-blue-600">Prevzatá doručenka</p>
                </div>
              <% else %>
                <p class="flex-grow-0 flex-shrink-0 w-[140px] text-base text-left text-gray-900">Typ doručenia:</p>
                <p class="flex-grow-0 flex-shrink-0 text-base font-semibold text-left text-gray-900">TODO</p>
              <% end %>
            </div>
          </div>
          <div class="flex flex-col justify-stretch items-end   relative gap-1">
            <div class="todo flex flex-col justify-stretch items-end   gap-1 pb-1">
              <div class="flex justify-stretch items-start  ">
                <div class="flex justify-center items-center    relative  gap-2.5 px-3.5 py-2.5 rounded-tr-md rounded-br-md bg-white border border-gray-300">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="  w-5 h-5 relative" preserveAspectRatio="xMidYMid meet">
                    <path d="M10 6.66667V10L12.5 12.5M17.5 10C17.5 10.9849 17.306 11.9602 16.9291 12.8701C16.5522 13.7801 15.9997 14.6069 15.3033 15.3033C14.6069 15.9997 13.7801 16.5522 12.8701 16.9291C11.9602 17.306 10.9849 17.5 10 17.5C9.01509 17.5 8.03982 17.306 7.12987 16.9291C6.21993 16.5522 5.39314 15.9997 4.6967 15.3033C4.00026 14.6069 3.44781 13.7801 3.0709 12.8701C2.69399 11.9602 2.5 10.9849 2.5 10C2.5 8.01088 3.29018 6.10322 4.6967 4.6967C6.10322 3.29018 8.01088 2.5 10 2.5C11.9891 2.5 13.8968 3.29018 15.3033 4.6967C16.7098 6.10322 17.5 8.01088 17.5 10Z" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </div>
              </div>
            </div>
            <p class="  text-base text-left text-gray-900"><%= l @message.delivered_at, format: :long %></p>
            <!--p class="todo   text-base text-left text-gray-500">(Ne)podpísané</p-->
          </div>
        </div>
      </div>
      <div class="flex flex-col justify-stretch items-start    relative gap-4 p-6 border-t-0 border-r-0 border-b border-l-0 border-gray-200">
        <!-- TODO: security diera, spravit inak -->
        <%= @message.html_visualization.html_safe %>
      </div>
      <div class="flex justify-start items-center    gap-4 px-6 py-4 bg-white border-t-0 border-r-0 border-b border-l-0 border-gray-200">
        <div class="flex justify-start items-start  relative gap-2">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="  w-6 h-6 relative" preserveAspectRatio="xMidYMid meet">
            <path d="M15.1715 6.99998L8.58553 13.586C8.39451 13.7705 8.24215 13.9912 8.13733 14.2352C8.03251 14.4792 7.97734 14.7416 7.97503 15.0072C7.97272 15.2727 8.02333 15.5361 8.12389 15.7819C8.22445 16.0277 8.37296 16.251 8.56074 16.4388C8.74853 16.6266 8.97183 16.7751 9.21762 16.8756C9.46342 16.9762 9.72678 17.0268 9.99233 17.0245C10.2579 17.0222 10.5203 16.967 10.7643 16.8622C11.0083 16.7574 11.229 16.605 11.4135 16.414L17.8275 9.82798C18.5562 9.07357 18.9593 8.06316 18.9502 7.01438C18.9411 5.96559 18.5204 4.96234 17.7788 4.22071C17.0372 3.47907 16.0339 3.0584 14.9851 3.04928C13.9363 3.04017 12.9259 3.44335 12.1715 4.17198L5.75653 10.757C4.63122 11.8823 3.99902 13.4085 3.99902 15C3.99902 16.5914 4.63122 18.1177 5.75653 19.243C6.88184 20.3683 8.4081 21.0005 9.99953 21.0005C11.591 21.0005 13.1172 20.3683 14.2425 19.243L20.4995 13" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          <p class="flex-grow-0 flex-shrink-0 w-[743px] text-base text-left text-gray-900">
            <span class="flex-grow-0 flex-shrink-0 w-[743px] text-base text-left text-gray-900">Správa obsahuje
              <span class="flex-grow-0 flex-shrink-0 w-[743px] text-base font-semibold text-left text-gray-900"><%= t('message_object', count: @message.objects.count, locale: :sk) %></span>
            </span>
          </p>
        </div>
      </div>
      <div class="flex flex-col justify-stretch items-stretch  relative gap-4 px-6 py-4 bg-white border-t-0 border-r-0 border-b border-l-0 border-gray-200">
        <%= render MessageAttachmentComponent.with_collection(@message.objects) %>
      </div>

      <% if @message.can_be_authorized? %>
        <%= form_with(url: authorize_delivery_notification_message_path(@message), method: :post, local: true, style:'width: 100%;') do |form| %>
          <div class="flex justify-strech items-start self-stretch flex-grow-0 flex-shrink-0 gap-2 p-6 border-t-0 border-r-0 border-b border-l-0 border-gray-200">
            <div class="flex justify-center items-center flex-grow-0 flex-shrink-0 relative overflow-hidden gap-2.5 px-3.5 py-2.5 rounded-md bg-blue-600">
              <%= form.submit "Prevziať správu", data: { turbo_confirm: 'Naozaj chcete prevziať správu?' }, class: "flex-grow-0 flex-shrink-0 bg-blue-600 text-base font-medium text-left text-white" %>
            </div>
          </div>
        <% end %>
      <% elsif @message.replyable? %>
        <div class="flex justify-strech items-start self-stretch flex-grow-0 flex-shrink-0 gap-2 p-6 border-t-0 border-r-0 border-b border-l-0 border-gray-200">
          <%= button_to message_drafts_path, method: :post, params: { original_message_id: @message.id }, class: "text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-3.5 py-2.5 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800" do %>
            Odpovedať
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
