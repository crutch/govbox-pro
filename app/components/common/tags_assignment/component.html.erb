<%= render Common::ModalComponent.new do |modal| %>
  <% modal.with_header do %>
    Úprava priradených štítkov
  <% end %>
  <% modal.with_modal_content do %>
    <%= form_with url: prepare_message_thread_tags_assignment_path(@message_thread),
                  data: { controller: 'debounce', debounce_target: 'form' } do |form| %>
      <div class="flex flex-col items-start gap-4 mt-4">
        <div class="w-full flex items-center rounded-md shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-blue-500">
          <div class="p-2">
            <%= render Icons::SearchComponent.new %>
          </div>
          <%= form.search_field :name_search, value: "", placeholder: "Vyhľadaj štítok",
                                data: { action: 'input->debounce#debounce' },
                                onreset: "this.form.requestSubmit()",
                                class: "grow border-0 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6" %>
        </div>
        <div>
          <% @init_tags_assignments.each do |tag_id, value| %>
            <%= hidden_field_tag "tags_assignments[init][#{tag_id}]", value %>
          <% end %>
        </div>
        <div class="w-full mt-2">
          <%= tag.turbo_frame id: Common::TagsAssignment::Component::LIST_FRAME do %>
            <%=
              render Common::TagsAssignment::ListComponent.new(
                all_tags: @all_tags,
                new_tags_assignments: @new_tags_assignments,
                filtered_tag_ids: @filtered_tag_ids,
                name_search: params[:name_search]) %>
          <% end %>
        </div>
      </div>

      <%= tag.turbo_frame id: Common::TagsAssignment::Component::CHANGES_FRAME %>

      <%= tag.turbo_frame id: Common::TagsAssignment::Component::ACTIONS_FRAME do %>
        <%= render Common::ModalActionsComponent.new %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
